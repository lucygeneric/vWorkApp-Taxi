<!DOCTYPE html> 
<html> 
  <head> 
  <title>vWorkApp &bull; Taxi Booking Prototype</title> 
  
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a1/jquery.mobile-1.0a1.min.css" />
  <link rel="stylesheet" href="css/mobiscroll-1.5.2.css" type="text/css" />
  <link rel="stylesheet" href="css/styles.css" />
  
  <!-- remote -->
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
  <script type="text/javascript" src="http://code.jquery.com/mobile/1.0rc2/jquery.mobile-1.0rc2.min.js"></script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <!-- vendor -->
  <script type="text/javascript" src="js/vendor/jquery.cookie.js"></script>
  <script type="text/javascript" src="js/vendor/jquery.fn.gmap.min.js"></script>
  <script type="text/javascript" src="js/vendor/jquery.ui.map.extensions.js"></script>
  <script type="text/javascript" src="js/vendor/mobiscroll-1.5.2.js"></script>
  <script type="text/javascript" src="js/vendor/knockout-1.2.1.js"></script>
  <!-- vWorkApp -->
  <script type="text/javascript" src="js/vWorkApp/vWorkAppGeo-1.0.0.js"></script>
  <script type="text/javascript" src="js/vWorkApp/vWorkAppUI-1.0.0.js"></script>
  <script type="text/javascript" src="js/vWorkApp/vWorkAppData-1.0.0.js"></script>
  <script type="text/javascript" src="js/vWorkApp/vWorkAppUtils-1.0.0.js"></script>
  
</head> 
<body> 

<div data-role="page" id="home" data-theme="a" >
   
	<div data-role="content">
		
		<img src="images/logo.png" id="logo" />	
		 
	    <h3 class='indented_heading'>Booking Details</h3>
			
		<ul data-role="listview" data-inset="true">
			<li>
				<a href="#pick_up">Pickup:</a>
				<p id="pick_up_button" class="split_button_text" data-bind="text: pick_up_address"></p>	
			</li>
			<li>
				<a href="#drop_off">Drop Off:</a>
				<p id="drop_off_button" class="split_button_text" data-bind="text: drop_off_address"></p>	
			</li>
			<li>
				<a href="#when">Date:</a>
				<p id="when_button" class="split_button_text" data-bind="text: pick_up_time">Today</p>
			</li>
			
		</ul>
		
		<a href="#tracking" id="request_submit" data-role="button">Book Now!</a>
		
	</div>
	 
</div>


<div data-role="page" id="pick_up" data-add-back-btn="true"> 

	<div data-role="header"><h1 id="status">Pick-up Location</h1></div>
	
	<div data-role="content"> 
		
		<label for="pick_up_address">Enter your pick-up location</label>
		<input type="text" name="pick_up_address" id="pick_up_address_input" data-bind="value: pick_up_address"  />
		
		<div id="pick_up_container" class="inset_list"></div>

	</div>	
	
</div>


<div data-role="page" id="drop_off" data-add-back-btn="true">

	<div data-role="header"><h1 id="status">Drop-off Location</h1></div>
	
	<div data-role="content"> 
		
		<label for="drop_off_address">Enter your drop-off location</label>
		<input type="text" name="drop_off_address" id="drop_off_address_input" data-bind="value: drop_off_address"  />
		
		<div id="drop_off_container" class="inset_list"></div>

	</div>	
	
</div>


<div data-role="page" id="when" data-add-back-btn="true">

	<div data-role="header"><h1 id="status">Pick-up time</h1></div>
	
	<div data-role="content"> 
		
		<div data-role="fieldcontain">
            
            <label for="date_entry">Enter your preferred pick up date:</label>
            <input type="text" name="date_entry" id="date_entry" class="mobiscroll" value="Today" />            
            
            <label for="time_entry">Enter your preferred pick up time:</label>
            <input type="text" name="time_entry" id="time_entry" class="mobiscroll" value="Right now" />
            
            <br /><br />
            
            <a href="#home" id="date_submit" data-role="button">Use these times</a>
            
        </div>
		
		
	</div>	
	
</div>


<div id="tracking" data-role="page" data-theme="b">
	
	<div data-role="header"><h1 id="status" data-bind="text: driver_status">Connecting...</h1></div>
	
	<div data-role="content" class="item"> 
		<div id="map_canvas"></div>
	</div>
	
	<div data-role="footer" class="ui-bar" id="map_footer" style="display:none"> 
		<a href="index.html" data-icon='alert' class="ui-btn-right" id="cancel_booking" data-role="button" onclick="vWorkTaxico.cancelBooking()">Cancel</a>
	</div>
	
	<!-- this had to be in the containing div..... bug in JQMobile -->
	<script type="text/javascript">
	
		$('#tracking').live("pageinit", function() {
			vWorkTaxico.generateBaseMap($('#map_canvas'));
		});
		
		$('#tracking').live("pagecreate", function() {
			var height = $("#tracking").height() - 85;
			$('#map_canvas').height(height);
			google.maps.event.trigger($('#map_canvas'), 'resize');
 		});
 		
	</script>

	
</div>


<script type="text/javascript">
		
	$('#drop_off_address_input').data('timeout', null).keyup(function(){
	
	    clearTimeout($(this).data('timeout'));
	
	    $(this).data('timeout', setTimeout(function(){
	        vWorkTaxico.populateListFromAddressLookup($('#drop_off_address_input').val(), "drop_off");
	    }, 1000));
	
	}); 
	
	$('#pick_up_address_input').data('timeout', null).keyup(function(){
	
	    clearTimeout($(this).data('timeout'));
	
	    $(this).data('timeout', setTimeout(function(){
	        vWorkTaxico.populateListFromAddressLookup($('#pick_up_address_input').val(), "pick_up");
	    }, 1000));
	
	}); 
	
	$('input[type=text]').focus(function() {
		$(this).val('');
	});
		
			
	$('#when').live("pagecreate", function() {
		
		$('#time_entry').scroller({ preset: 'time', theme: 'ios', ampm: false });
		$('#date_entry').scroller({ preset: 'date', theme: 'ios' });
		
		$('#date_submit').click(function() {
			var date = vWorkTaxico.getCurrentDateFromDateTimeEntry($('#date_entry'),$('#time_entry'));
			vWorkTaxico.setModelValue('pick_up_time', date);
		});
		
	});
	
	$('#home').live("pagecreate", function() {

		vWorkTaxico.initaliseModel();
		vWorkTaxico.getCurrentAddress(function(result){
			vWorkTaxico.setModelValue('pick_up_address',result);
		});
	
		$('#request_submit').click(function(event) {
			
			var e = vWorkTaxico.validateBookingModel();

			if (e != null){
				vWorkTaxico.dialog(e);
				event.preventDefault();
				event.stopImmediatePropagation();
			}
			
			vWorkTaxico.cookiefyModel();
			vWorkTaxico.commitBooking();	
		});
		
	});
	
	$('#tracking').live("pageshow", function() {
		vWorkTaxico.watchMap($('#map_canvas'));
		vWorkTaxico.createPickupMarker($('#map_canvas'));
		$('#map_footer').css('display','block');
	});
	
	$('#tracking').live("pagehide", function() {
		vWorkTaxico.unWatchMap();
	});

	
	

</script>


 
</body>
</html>